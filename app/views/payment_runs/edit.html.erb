
<table class='rapport5'>
<% 

   def num_format num
   return num
#      return number_to_human(num, :precision => 2)
   end


   odd = false
   ledger = nil
   @matches.each do
     |ops| 
     odd = !odd
     odd_str = odd ? "odd" : "even"

   if ledger != ops[0].ledger then
     ledger = ops[0].ledger
%>
  <tr>
    <th colspan='7'>
      <%= ledger.name %>
    </th>
  </tr>
  <tr>
    <th>
      Debet
    </th>
    <th>
      Kredit
    </th>
    <th>
      Forfallodato
    </th>
    <th>
      KID
    </th>
    <th>
      Faktura #
    </th>
    <th>
      Tekst
    </th>
    <th>
    </th>
  </tr>

<%
   end

%>



  <tr class='<%= odd_str %>'>
    <td class='number'>
      <%= num_format(ops[0].amount > 0 ? ops[0].amount : "") %>
    </td>
    
    <td class='number'>
      <%= ops[0].amount < 0 ? ops[0].amount : "" %>
    </td>
    
    <td>
      <%= ops[0].journal.due_date %>
    </td>
    
    <td>
      <%= ops[0].journal.kid %>
    </td>
    <td>
      <%= ops[0].journal.bill_number %>
    </td>
    <td>
      <%= ops[0].journal.description %>
    </td>
    <td rowspan='2'>
      <form method='post' action='/payment_runs/create'>
	<input type='hidden' name='ops[0]' value='<%=ops[0].id %>'>
	<input type='hidden' name='ops[1]' value='<%=ops[1].id %>'>
	<input type='hidden' name='pay_id' value='<%= @pay_id %>'>
	<button type='submit'>Lukk</button>
      </form>
    </td>

  </tr>
  <tr class='<%= odd_str %>'>
    <td class='number'>
      <%= ops[1].amount > 0 ? ops[1].amount : "" %>
    </td>

    <td class='number'>
      <%= ops[1].amount < 0 ? ops[1].amount : "" %>
    </td>
        
    <td>
      <%= ops[1].journal.due_date %>
    </td>
    
    <td>
      <%= ops[1].journal.kid %>
    </td>
    <td>
      <%= ops[1].journal.bill_number %>
    </td>
    <td>
      <%= ops[1].journal.description %>
    </td>
  </tr>

<% end %>

</table>


<table class='striped'>

<%

   def footer
%>
  <tr>
    <th colspan='6'>
    </th>
    <th>
      <button type='submit'>Lukk</button>
    </th>
  </tr>
  </form>

<%


   end

   ledger = nil
   @ops.each do
     |op| 


     if ledger != op.ledger and ledger != nil then
       footer
     end

     if ledger != op.ledger then
       ledger = op.ledger

%>
  <form action='/payment_runs/create' method='post'>
    <input type='hidden' name='pay_id' value='<%= @pay_id %>'>
  <tr>
    <th colspan='7'>
      <%= ledger.name %>
    </th>
  </tr>
  <tr>
    <th>
      Debet
    </th>
    <th>
      Kredit
    </th>
    <th>
      Forfallodato
    </th>
    <th>
      KID
    </th>
    <th>
      Faktura #
    </th>
    <th>
      Tekst
    </th>
    <th>
    </th>
  </tr>

<%
   end
%>

  <tr>
    <td class='number'>
      <%= num_format(op.amount > 0 ? op.amount : "") %>
    </td>
    
    <td class='number'>
      <%= op.amount < 0 ? op.amount : "" %>
    </td>
    
    <td>
      <%= op.journal.due_date %>
    </td>
    
    <td>
      <%= op.journal.kid %>
    </td>
    <td>
      <%= op.journal.bill_number %>
    </td>
    <td>
      <%= op.journal.description %>
    </td>
    <td>
      <input type='checkbox' name='ops[]' id='check_<%= op.id %>' value='<%=op.id %>'><label for='check_<%= op.id %>'>Lukk</label>
    </td>

</tr>
<%

   end

  if ledger != nil then footer end

%>

</table>


